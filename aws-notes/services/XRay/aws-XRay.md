# AWS X-Ray

## 概要

分散アプリケーションの可視化ツール

リクエストがアプリケーション内でどのように処理されるかを「エンドツーエンド」で追跡

ボトルネックやエラーの原因を特定

## できること

### リクエストのトレーシング

ユーザーが API Gateway → Lambda → DynamoDB へリクエストした流れを記録

各サービス間の遅延やエラーを可視化

### パフォーマンスボトルネックの特定

どこで処理が遅いか（API Gateway？Lambda？DB？）を把握可能

### 可視化

サービスマップを自動生成して、アプリケーション全体の構造を一目で確認

## ユースケース

- マイクロサービス環境（ECS, EKS, Lambda, API Gatewayなど）でのトラブルシューティング
- 本番環境の監視（レイテンシ増加やエラー調査）
- 開発・テスト時に「想定通りのサービス間呼び出しができているか」を確認

## 競合/類似サービス

- Datadog APM
- New Relic
- OpenTelemetry（オープンソースの標準規格）

X-Ray は AWS ネイティブなので、AWSサービスとの統合が簡単＆低コストという強み

## まとめ

AWS X-Ray = AWS版の分散トレーシングサービス

「ユーザーのリクエストがどのサービスを通って、どこで遅延やエラーが起きているか」を可視化するツール

---

# AWS X-Ray サンプリング

## サンプリングとは

X-Ray はアプリケーションの全リクエストをトレースするとコスト・パフォーマンスに悪影響が出るので、一部のリクエストだけを記録する仕組みが必要。これが「サンプリング」

## サンプリングのルール構成

### Reservoir（リザーバーサイズ）

毎秒「必ず」収集するトレースの件数

例: Reservoir = 5 → 毎秒5件は必ず記録

### Fixed rate（固定レート）

リザーバーを使い切った後、残りのリクエストに対して適用する割合

例: Rate = 0.05 (5%) → 残りのリクエストの5%を記録