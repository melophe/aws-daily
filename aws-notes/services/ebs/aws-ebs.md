# Amazon EBS (Elastic Block Store)

## 基本概要

### 利用対象
- **対応**: EC2で使うストレージ
- **制限**: ECSでは直接使えない（EC2起動タイプなら使える）

### 特徴
- **データ共有**: EBSはインスタンス間でデータ共有できない
- **冗長性**: EBSボリュームは単体でも冗長化されている
  - AZ内で自動的にレプリケート
  - ディスク障害から保護される

### 性能の制約と解決策
- **制約**: 「IOPS」や「スループット」はボリュームサイズや種類に依存
- **解決策**: より高性能が欲しいときに「複数EBSをRAIDで束ねる」手法が使われる

## EBSと組み合わせるRAIDの種類

EBSではよく次のRAIDレベルが使われます：

### 1. RAID 0（ストライピング）

#### 特徴
- 複数EBSにデータを分散して並列書き込み

#### メリット・デメリット
- **メリット**: IOPSとスループットが n倍 に向上（例: 4本で4倍速）
- **デメリット**: 耐障害性なし（1本壊れると全体アウト）

#### ユースケース
- 高性能キャッシュ領域
- 一時データ処理（例: 大規模データの並列処理）

### 2. RAID 1（ミラーリング）

#### 特徴
- 同じデータを複数EBSに複製

#### メリット・デメリット
- **メリット**: 冗長性が高い（1本壊れても生存）
- **デメリット**: 容量効率が50%（2TBで実効1TB）

#### ユースケース
- 可用性を重視するOLTP系DB

### 3. RAID 10（1+0）

#### 特徴
- RAID 0 と RAID 1 を組み合わせ（ミラーされたペアをストライピング）

#### メリット・デメリット
- **メリット**: 性能と耐障害性を両立
- **デメリット**: 容量効率は50%

#### ユースケース
- 高スループットが必要なDB（MySQL, Oracle など）

## AWS公式の推奨事項

### 推奨されるRAIDレベル
- **RAID 0**: 性能を最大化したいとき
- **RAID 1/10**: データ保護も求められるとき

### 推奨されないRAIDレベル
- **RAID 5/6**: 書き込み性能が低下し、EBSの冗長性と二重になって非効率

## 実装・運用の注意点

### 実装方法
- **OS レベルで実装**: EC2内でmdadmなどを使う

### 運用上の注意
- **RAID 0 利用時**: 「バックアップ必須」（EBSスナップショットを組み合わせる）
- **代替案**: EBSの**プロビジョンドIOPS（io1/io2）**を選べば、RAIDを使わずに高性能を得られる場合も多い

## 用途別の使い分け

| 目的 | 推奨RAID | 理由 |
|------|----------|------|
| **可用性向上・RTO短縮** | RAID 1 | 冗長性を重視 |
| **性能向上** | RAID 0 | 読み書きを高速化（ストライピング） |

## ストライピング（RAID 0）の仕組み

### ストライピングとは？

**データを「小さなブロック」に分割して、複数のディスクに並列に書き込む/読み込む方式**

> **例え**: 「1本の道に全部の車を通すんじゃなくて、複数車線に分散して同時に流す」イメージ

### 具体例: 2本のEBSをRAID 0でストライピング

#### 処理の流れ
1. **データ分割**: 書き込みたいデータ（100MB）を2分割（50MB + 50MB）
2. **並列書き込み**: ディスク1に50MB、ディスク2に50MBを同時に書き込む

#### 結果
- **書き込み速度**: 2倍速い 🚀
- **読み込み速度**: 2ディスクから並列でできるので2倍速

### ストライピングのメリット・デメリット

#### メリット
- **高速性**: IOPSとスループットが大幅に増える

#### デメリット
- **耐障害性なし**: 1本でも壊れたら全体のデータが壊れる