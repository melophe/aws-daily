# AWS DataSync

## 概要

オンプレミス環境（HDFS含む）とAWSのストレージサービス間でデータ転送を行うサービス

---

## DataSync ができること

### 対応する転送パターン

- HDFS ⇔ Amazon S3
- HDFS ⇔ Amazon EFS
- HDFS ⇔ Amazon FSx

### 主な機能

- **差分コピー**: 変更分のみを効率的に転送
- **圧縮**: データを圧縮して転送効率を向上
- **並列転送**: 複数のファイルを同時転送

DataSyncの「相手」はストレージサービスに限られる

---

## DataSync ができないこと

### 制限事項

| 制限 | 理由 |
|------|------|
| **直接EMRクラスターに接続することは不可** | EMRは「計算基盤」なので、ストレージのようにDataSyncの転送先に指定できない |

---

## 主な機能詳細

### 高速転送
- オープンソースのツール（rsync, robocopy等）よりも最大10倍高速
- 転送プロトコルが最適化されており、並列化・圧縮・帯域制御が可能

### 対応するソース・ターゲット

#### オンプレミス側
- NAS（NFS, SMB）
- オブジェクトストレージ（S3 API対応）

#### AWS側のストレージサービス
- Amazon S3
- Amazon EFS
- Amazon FSx (FSx for Windows, FSx for Lustre等)

### セキュア転送
- 暗号化（TLS）
- IAM統合
- VPCエンドポイント対応
- 転送の整合性チェック付き

### スケジュール & 自動化
- 一回きりのデータ移行（One-time Migration）
- 定期同期（スケジュール設定して差分のみ同期）

---

## DataSync だけでは対応できないケース

### データベースの移行
MySQL/PostgreSQL/Oracle/SQL Server等のDBはDataSyncでは扱えない

Database Migration Service (DMS) を使用

### アプリケーションやサーバー全体の移行
オンプレの仮想マシンをそのままAWSに移したい場合

AWS Application Migration Service (MGN) を使用

### ネットワークが細い or 大容量すぎるケース
ネット越しでは現実的でない場合

AWS Snowball/Snowmobileを使用して物理的にデータを運搬

---

## ネットワーク接続オプション

DataSyncは単独でもインターネット経由でTLS暗号化して安全に転送可能

要件によってはDirect ConnectやSite-to-Site VPNと組み合わせて使用

### Direct Connect と組み合わせるケース

#### 要件
大容量データを長期間・安定的に移行したい

#### 理由
- インターネット経由だと帯域が不安定
- セキュリティポリシー的にインターネット経由がNG

#### 利用例
- オンプレのNAS → S3 / FSxに毎日数TB同期
- 医療・金融でインターネットを避けたいシステム

Direct Connect経由でVPCに専用線を接続し、DataSyncエージェントをVPC内に配置する構成で高帯域・安定・セキュアな転送を実現

### Site-to-Site VPN と組み合わせるケース

#### 要件
オンプレ ↔ AWSをインターネット越しで接続するが、暗号化トンネルを張りたい

#### 理由
インターネット回線しかないが、セキュリティは必須

#### 利用例
- 本社のファイルサーバーを定期的にAWSにバックアップ
- 支社のシステムをVPN越しにAWSにレプリケーション

DataSyncエージェントをオンプレに配置し、Site-to-Site VPN越しにAWSストレージへ転送

---

## まとめ

### DataSync の特徴
- オンプレミスとAWSストレージ間のデータ転送サービス
- 効率的な転送機能（差分コピー、圧縮、並列転送）を提供
- 対象はストレージサービスのみ、計算基盤（EMR等）は直接対象外

### ネットワーク接続の選択指針
- **DataSync単独**: TLS暗号化で十分安全
- **より強いセキュリティ or 安定帯域が必要**: Direct Connect（専用線）またはSite-to-Site VPN（暗号化トンネル）を組み合わせて利用

---

## DataSync エージェントが必要かどうか

結論から言うと、接続元がオンプレか、AWSサービスかで変わる

### エージェントが必須のケース

#### オンプレミスのストレージ → AWS
- NFS サーバー、SMB サーバー、HDFS など
- VMware/Hyper-V/KVM 上の VM でエージェントをデプロイする必要がある
- これがオンプレと AWS をつなぐ役割

### エージェントが不要なケース

#### AWS サービス間の転送
- 例: S3 ↔ S3、S3 ↔ EFS、S3 ↔ FSx、EFS ↔ FSx
- これらは DataSync がマネージドで直接やり取りするので エージェント不要

---

## まとめ

- オンプレ → AWS = エージェント必須
- AWS ↔ AWS = エージェント不要