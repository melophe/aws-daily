# Amazon MQ

## 概要

**アプリケーション間の非同期通信を仲介するメッセージブローカーをマネージドで提供**

- オープンソースの **Apache ActiveMQ や RabbitMQ** をベースにしている
- 開発者はブローカーの運用・パッチ・可用性管理をAWSに任せられる

## 主な用途

- **マイクロサービス間のメッセージ連携**
- **異なるシステムや言語間の疎結合な連携**
- **古いオンプレアプリのクラウド移行**（既にActiveMQやRabbitMQを使っているケース）

## Amazon MQ の特徴

### フルマネージド
- ソフトウェアのインストール、運用、パッチ適用不要

### 既存プロトコルに対応
- **MQTT, AMQP, STOMP, OpenWire, JMS** など、標準のメッセージングプロトコルをそのまま使える

### 高可用性
- **マルチAZ配置**に対応

### スケーラビリティ
- **大規模スケーリングは苦手**（その場合は **SQS / SNS** の方が向いている）

## 他のAWSメッセージングサービスとの違い

| サービス | 特徴 | ユースケース |
|----------|------|--------------|
| **Amazon SQS** | 完全マネージドのキュー。高スケーラブル、低運用 | マイクロサービス連携、イベント駆動アプリ |
| **Amazon SNS** | パブリッシュ/サブスクライブ型の通知サービス | ファンアウト通知、イベント配信 |
| **Amazon MQ** | オープンソース互換のブローカー。既存アプリを容易に移行できる | JMSやAMQPなど標準プロトコルを使うレガシー/既存アプリの移行 |

### 使い分け指針

- **Amazon MQ** = 「既存のメッセージブローカー資産をそのままクラウドに移す」ためのサービス
- **新規開発なら SQS や SNS の方がスケーラブルでコスト効率が良い**

> **まとめ**: Amazon MQ = マネージドActiveMQ/RabbitMQ。標準メッセージングプロトコルを使う既存アプリのクラウド移行に最適

## アクティブ/スタンバイ構成

### 基本構成

- **2つのブローカー**（プライマリとセカンダリ）を**異なるアベイラビリティゾーン (AZ)** に配置
- 普段は**アクティブ（プライマリ）ブローカー**がリクエストを処理
- 万が一アクティブが落ちたら、**スタンバイ（セカンダリ）ブローカー**が引き継いで処理する
- この切り替えを**フェイルオーバー**と呼ぶ

### ユーザー体験

**ユーザー（クライアントアプリ）から見ると、単一のエンドポイントに接続するだけで、自動的に稼働中のブローカーに接続できる**

### メリット

- **高可用性 (HA)**: AZ障害やブローカー障害時でも自動的に復旧
- **データ保護**: メッセージは共有ストレージに保存されるので、切り替え時にデータロスが発生しにくい
- **管理不要**: クラスタリングやレプリケーション設定をAWSが代わりにやってくれる

## Amazon MQ のデプロイモード

### シングルインスタンスブローカー
- **開発・テスト用**、安いけど耐障害性はない

### アクティブ/スタンバイブローカー
- **本番用**、マルチAZに配置され高可用性

## まとめ

**Amazon MQ のアクティブ/スタンバイ = マルチAZの高可用性構成**

- **普段はアクティブが処理**
- **障害時はスタンバイがフェイルオーバーして継続**
- **ユーザー側は意識せずに利用できる**

Advanced Messages Onchain Protocol (AMOP) プロトコルは、Apache ActiveMQで使用されるメッセージングプロトコル

Amazon MQを利用することでApache ActiveMQを用いたキューイングを実施することが可能