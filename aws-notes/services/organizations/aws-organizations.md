# AWS Organizations

## 概要

**複数の AWS アカウントを一元的に作成・管理するサービス**

企業が部署やプロジェクトごとにアカウントを分けて利用する際の統制ツール

## 主要機能

### 1. アカウントの統合管理

#### 機能
- **管理アカウント**から新しいアカウントを作成
- 既存アカウントを組織に招待

#### 効果
- 部門やプロジェクトごとに独立したアカウントを保持
- 中央で一元的に管理可能

### 2. 統合請求（Consolidated Billing）

#### 機能
- 複数のアカウントをまとめて一括請求

#### 効果
- **ボリュームディスカウント**（使用量の合算による割引）を全アカウントで共有

### 3. サービスコントロールポリシー（SCP）

#### 機能
- 各アカウントや組織単位に対して**利用できるサービスや操作の制限**を適用

#### 例
- 開発用アカウントではコストの高いインスタンスタイプを禁止

### 4. IAM Identity Center との統合

#### 機能
- Organizations に参加している**全アカウントに対してユーザーアクセスを一元管理**

#### 効果
- 単一のログイン基盤で複数アカウントにアクセス

## IAM Identity Center との統合

### 基本構造

#### AWS Organizations
- 複数アカウントを束ねる「入れ物」
- **管理アカウント**（旧マスターアカウント）と**メンバーアカウント**で構成
- **OU（Organizational Unit）**でツリー構造に整理可能

#### IAM Identity Center（旧 AWS SSO）
- **認証・認可を一元管理**するサービス
- 「どのユーザーが」「どのアカウントに」「どの権限で」入れるかを設定

> 統合すると、Organizations に所属する**アカウント全て**を Identity Center の管理画面から制御可能

### 統合の流れ

1. **Organizations で「すべての機能」を有効化**
2. **管理アカウントで IAM Identity Center を有効化**
3. **自動的に Organizations と統合**
4. **参加アカウント情報が Identity Center に同期**

#### Identity Center の設定
- **ユーザー作成** または **外部 IdP**（オンプレ AD や Azure AD など）と連携
- 各ユーザー/グループに **Permission Set（権限セット）とアカウントのマッピング** を割り当て

### 権限管理の仕組み

#### Permission Set（権限セット）作成
- **中身**: IAM ポリシー（例：AdministratorAccess、ReadOnlyAccess）

#### ユーザー/グループとアカウントをマッピング
- 「営業部グループ → アカウントA（ReadOnlyAccess）」
- 「開発部グループ → アカウントB（AdminAccess）」

#### 効果
- ユーザーは **1回のログイン（シングルサインオン）** で必要な AWS アカウントに切り替えアクセス可能

### 外部ディレクトリとの統合

#### ユーザーストアの選択肢
| オプション | 特徴 |
|-----------|------|
| **内蔵 Identity Center ディレクトリ** | 簡単だが運用規模が小さい場合向き |
| **AWS Managed Microsoft AD** | AWS管理の Active Directory |
| **オンプレミス AD** | AD Connector 経由 |
| **外部 IdP** | Azure AD, Okta, Ping, Google Workspace など |

> オンプレ AD を使う場合、**AWS Directory Service（AD Connector）** を Identity Center に統合するのが王道

### 利用者視点の動作フロー

1. **ログイン**: 会社アカウント（オンプレ AD）で IAM Identity Center にログイン
2. **ポータル表示**: 「自分が使える AWS アカウントと権限」が一覧表示
3. **アクセス**: 必要なアカウントをクリック → IAM ロールが自動割り当て → そのアカウントのコンソールに遷移

## 全体構成まとめ

| コンポーネント | 役割 |
|---------------|------|
| **Organizations** | アカウントの木構造を管理する器 |
| **IAM Identity Center** | 誰がどのアカウントにどの権限で入れるかを一元管理する仕組み |
| **外部ディレクトリ（AD等）** | ユーザーの認証基盤 |