# Amazon SNS (Simple Notification Service)

## 概要

クラウド上で動作するメッセージング・通知サービス
アプリケーション間やアプリケーションから人への通知を簡単に送信できる

## 特徴

### Pub/Sub モデル (Publish/Subscribe)

発行者（Publisher）がメッセージを「トピック」に送信すると、登録者（Subscriber）がそのメッセージを受け取る仕組み

#### 例
```
CloudWatch アラーム → SNS トピック → 管理者のメール・Slack・Lambda に通知
```

### 複数のプロトコルに対応

SNS はメッセージをさまざまなエンドポイントに配信できる

| プロトコル | 用途 |
|------------|------|
| **Email** | メール通知 |
| **SMS** | 携帯電話のショートメッセージ |
| **モバイルプッシュ通知** | APNs、GCM など |
| **HTTP/HTTPS エンドポイント** | Web サービスへの通知 |
| **Amazon SQS** | キューサービス連携 |
| **AWS Lambda** | サーバーレス関数の自動実行 |

### スケーラブルで高可用性

- **フルマネージド**なのでサーバー管理不要
- イベントが増えても自動的にスケール

## よくあるユースケース

### アラート通知
CloudWatch で異常検知 → SNS で管理者にメール/Slack 通知

### イベント駆動アーキテクチャ
アプリが SNS にイベント発行 → Lambda や SQS で処理を分散

### ユーザー通知サービス
EC サイトで「注文完了」メールや SMS 送信

### 分散システム間の連携
あるマイクロサービスの更新を SNS でブロードキャストして他サービスに伝達

## 主な機能

- **Push 通知** - モバイルアプリへの通知
- **SMS** - 携帯電話への文字メッセージ
- **Email** - メール送信
- **HTTP/HTTPS** - Web サービスへの通知
- **SQS** - 他の AWS サービスとの連携

## まとめ

- **イベント通知やメッセージ配信のハブ**
- Pub/Sub モデルで複数宛先に簡単に配信可能
- 運用管理が不要でスケーラブル

## SNS の役割

SNS は**トピック（Topic）という中継地点**を用意して、

1. Publisher がトピックにメッセージを送る
2. そのトピックに登録している Subscriber 全員にメッセージを配信する

```
Publisher → [ SNS トピック ] → Subscriber A (メール)
                              → Subscriber B (SMS)
                              → Subscriber C (Lambda)
```

### 用語解説
- **Publisher** = 発信者（メッセージを出す側）
- **Subscriber** = 受信者（通知を受け取る人やシステム）
- **SNS** = Publisher と Subscriber をつなぐ中継ハブ

## SNS トピック

### 概要
- メッセージを配信するための「チャンネル」のようなもの
- 1つのトピックに複数の受信者（サブスクライバー）を登録できる
- パブリッシュ・サブスクライブ（Pub/Sub）モデルの中心概念

### トピックタイプ
- **Standard**: 順序保証なし、高スループット
- **FIFO**: 順序保証あり、重複排除機能

### 基本的な流れ
1. **トピック作成**
2. **サブスクライバー追加**（SMS、Email、HTTP等）
3. **メッセージをパブリッシュ**
4. **全サブスクライバーに一斉配信**

## パブリッシュとは

### 定義
- 作成した SNS トピックに対してメッセージを送信すること
- 「投稿する」「配信する」という意味

### パブリッシュする方法
- **AWS コンソール** - ブラウザから手動送信
- **AWS CLI** - コマンドライン
- **SDK** - プログラムから自動送信
- **他の AWS サービス** - Lambda、CloudWatch など

## サブスクライブの流れ

### サブスクライブ = 事前設定

```
1. SNS トピック作成「system-alerts」
   ↓
2. 電話番号 +819012345678 を「サブスクライブ」
   ↓  
3. 確認 SMS → 承認
   ↓
4. 登録完了（事前設定完了）
   ↓
5. 後日、トピックにメッセージをパブリッシュ
   ↓
6. 登録済みの番号に自動で SMS 送信
```

## SMS 送信の2つの方法

### A. 直接送信（事前設定不要）
- その都度、電話番号を指定して SMS 送信
- `PhoneNumber='+819012345678'`

### B. トピック経由（事前設定必要）
- 事前にサブスクライブ登録
- 後は `TopicArn` だけで SMS 送信