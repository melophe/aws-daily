# AWS Lake Formation

## データレイクとは

### 定義
**大量のデータを生のまま（構造化・非構造化を問わず）貯めておけるストレージ基盤**

### AWS での実装
- **基盤**: Amazon S3 を使用
- **データ例**: ログ、CSV、Parquet、画像、IoTセンサー、動画など全てを S3 に保存

### 課題
> データはS3にあるけど、権限管理・スキーマ管理・アクセス制御が大変

## Lake Formation の役割

**S3上にデータレイクを作るときの管理ツール**として以下の機能を提供：

### 1. データの取り込みを簡単に

#### 対応データソース
- RDS
- DynamoDB
- Redshift
- オンプレミスDB

#### 機能
- 各データソースから S3 への取り込みを自動化

### 2. データカタログ管理

#### 基盤技術
- **AWS Glue Data Catalog** を基盤として利用

#### 管理内容
- スキーマ情報
- データの場所
- パーティション情報

> どんなデータがあるかを一元管理

### 3. きめ細かいアクセス制御

#### 従来の課題
- **IAMのみ** → 制御が複雑になりがち

#### Lake Formation の改善
**細粒度のアクセス制御が可能：**

- **テーブル単位**
- **カラム単位**
- **行単位**

#### 対応サービス
- Athena
- Redshift Spectrum
- EMR
- Glue

### 4. データ分析基盤と統合

#### 機能
- データを取り込み後、Athena や Redshift Spectrum で直接クエリ可能
- 権限も Lake Formation で一元管理

> データの実態はS3にあり、Lake Formation はそれを管理するサービス

## Lake Formation の具体的な機能

### 1. メタ情報管理
- **Glue Data Catalog** を使ってメタ情報を管理
- **データ辞書**: 「このS3バケットにこういう形式のデータがある」という情報を作成

### 2. アクセス制御の強化
従来のS3単位のバケットポリシーやIAM権限に加えて：

- **テーブル単位**
- **カラム単位**
- **行単位**

でアクセス権を設定可能

### 3. データ取り込み・整理の自動化
- **データインポート**: RDSやオンプレDBからS3への取り込み
- **データ変換**: 標準的な形式（Parquetなど）に変換して分析を最適化

## アーキテクチャ理解

### 役割分担

| コンポーネント | 役割 |
|---------------|------|
| **S3** | データ倉庫（実体が全部ここにある） |
| **Glue Data Catalog** | 目録（どの棚に何が置いてあるか記録） |
| **Lake Formation** | 倉庫の管理人（目録＋誰がどのデータを見れるか管理） |

## まとめ

### 質問への回答
**「Lake FormationはS3に対して細粒度のアクセス制御を提供する？」** → ****

### Lake Formation の価値
- S3ベースのデータレイク構築・管理を大幅に簡素化
- 企業レベルのデータガバナンスとセキュリティを提供

## Lake Formationによるデータ共有

### 1. 共有の仕組み

#### データカタログベースの共有
**Lake FormationはGlue Data Catalog上の「テーブル定義」をベースに共有**

#### コピー不要の機能
- **データ自体（S3のファイル）をコピーしない**
- **参照権限を他のAWSアカウントに付与**

#### 共有先での利用
**共有先は自分のアカウントからAthena/Redshift Spectrum/EMRなどでそのテーブルをクエリ可能**

> ** ポイント**: 「データは自分のS3に置いたまま、他社にクエリ権限だけ渡す」ことができる

### 2. メリット

#### コスト効率
- **コピー不要 → コスト削減**
- **データを重複保存しないで済む**

#### セキュリティ強化
**IAMやS3バケットポリシーより細かい制御が可能（列・行単位）**

#### 運用性の向上
**データカタログを共有するだけで、スキーマやテーブル定義が相手側でそのまま使える**

### 3. 具体的なユースケース

#### B2Bデータ連携
**サードパーティー企業に販売データの一部だけを提供**

#### 社内データガバナンス
**社内の異なる部門（営業・マーケ・データ分析チーム）に同じS3データを安全に共有**

#### 外部パートナー連携
**外部パートナーがAthenaを使って自分のアカウントから直接クエリできるようにする**

### まとめ
**Lake Formationは「データのコピーなしで安全に共有する仕組み」を提供**

S3 の場合

そのまま Lake Formation に登録できる

Lake Formation は 「データレイクのカタログ管理」 をしているイメージ

なので S3 バケットをデータソースとして指定すれば、Glue Data Catalog 経由でテーブルとして認識できる

→ 追加のETL処理なしで Athena や Redshift Spectrum からクエリ可能

🔹 RDS の場合

RDS のデータは 直接 Lake Formation に食わせられない

代わりに AWS Glue のクローラー を使ってスキーマをカタログ化する必要がある

Glue の JDBC コネクタで RDS（PostgreSQL, MySQL など）に接続し、テーブル定義を Data Catalog にインポート

これで Lake Formation 経由でアクセス制御しつつ、Athena/Redshift/EMR から分析できる