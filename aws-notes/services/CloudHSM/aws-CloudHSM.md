# AWS CloudHSM

## 概要

**マネージド型ハードウェアセキュリティモジュール（HSM）サービス**

**HSM**とは、暗号鍵を安全に生成・保管・利用するための専用ハードウェアデバイス。金融機関や政府機関など、高いセキュリティとコンプライアンスが求められるシステムで使用される。

## 主要特徴

### 1. FIPS 140-2 Level 3 認定
- セキュリティ標準に準拠したハードウェアで運用

### 2. 鍵の完全管理
- **AWS 側では鍵の中身を一切知ることができない**
- 鍵はユーザー自身が HSM 内で生成・管理

### 3. マネージド型
- **AWS が HSM クラスタの冗長化や可用性を自動管理**
- ユーザーは「HSM の管理者」として使用するだけ

### 4. PKCS#11 / JCE / CNG API 対応
- 既存のアプリケーションが HSM を使いやすいように標準的な暗号 API をサポート
- **適用範囲**: TLS/SSL の鍵管理、データ暗号化、署名処理など

## CloudHSM と KMS の基本的な違い

### AWS KMS
- マネージド型の「簡単に使える」鍵管理サービス
- 鍵は AWS が管理。ユーザーは API 経由で暗号操作を実行
- 多くの AWS サービス（S3, RDS, EBS など）と統合
- 運用は楽だが、鍵のライフサイクルは AWS に依存

### AWS CloudHSM
- ユーザーが「HSM デバイス」を直接管理
- 鍵は AWS に見えないので、より強力なセキュリティ要求やコンプライアンス（PCI DSS, 金融規制など）に対応
- 柔軟性が高い反面、KMS より運用コストが重い

### 選択指針
- **簡単さ優先** → **KMS**
- **コンプライアンス＆フルコントロール優先** → **CloudHSM**

## 使用シーンの例

- **金融システム**: クレジットカード決済の暗号鍵管理
- **政府機関システム**: 秘密情報の保護
- **PKI（公開鍵基盤）**: 証明書の発行システムの鍵保護
- **規制対応**: 高度なコンプライアンス要件がある業界

> **CloudHSM** = 自分で完全に制御できる専用の暗号用ハードウェアをクラウドで使えるサービス

## 詳細比較: KMS vs CloudHSM

### 1. 管理主体

#### KMS
- 鍵の生成・保存・ライフサイクル管理を **AWS が管理**
- ユーザーは API 経由で暗号化・復号や署名などを利用するだけ

#### CloudHSM
- 鍵は HSM 内で生成・保存され、**ユーザーのみが管理者**
- AWS も鍵の中身にアクセスできない

> **選択基準**: 「AWS に任せたい」なら KMS、「自分で完全に制御したい」なら CloudHSM

### 2. セキュリティ & コンプライアンス

#### KMS
- **FIPS 140-2 Level 2** に準拠
- 多くのセキュリティ要件には十分対応

#### CloudHSM
- **FIPS 140-2 Level 3** に準拠（より高いセキュリティ）
- PCI DSS や金融・政府機関の厳格な要件にも適合

> **選択基準**: 規制が厳しい業界（金融、公共）では CloudHSM が選択されやすい

### 3. 使いやすさ

#### KMS
- ほとんどの AWS サービスと**ネイティブ統合**（S3, RDS, EBS など）
- 「暗号化を有効化」チェックするだけで利用可能
- **運用が圧倒的に楽**

#### CloudHSM
- **ネイティブ統合なし**
- PKCS#11, JCE, CNG などの暗号 API を使ってアプリ側から直接接続
- 運用の知識（鍵のバックアップ、クラスタ管理）が必要

> **選択基準**: 手軽さ重視 → KMS、柔軟性＆自由度重視 → CloudHSM

### 4. コスト & 運用

#### KMS
- **リクエスト課金**（例：$0.03/1万リクエスト）
- 初期費用なし、安価

#### CloudHSM
- **HSM アプライアンスを専有**するので高額（1クラスタあたり月数千ドル〜）
- 高可用性のために**最低2台構成が推奨**

> **選択基準**: 小規模・コスト意識 → KMS、大規模で予算あり＆コンプライアンス必須 → CloudHSM

## 利用シーン別推奨

### KMS が適しているケース
- **AWS サービスのデータ暗号化**（S3, RDS, DynamoDB, EBS 等）
- **簡単に鍵管理をクラウドで済ませたい場合**
- **高度な規制は求められていない場合**

### CloudHSM が適しているケース
- **金融機関や政府のシステム**など、「AWS に鍵を管理させてはいけない」規制がある場合
- **PKI（証明書発行基盤）**、暗号署名サーバー、トークン認証など特殊用途
- **鍵の完全制御が必要な場合**

## まとめ

| サービス | 特徴 |
|----------|------|
| **KMS** | AWS 管理の簡単・低コストな鍵管理 |
| **CloudHSM** | 自分で完全に制御する高セキュリティ＆高コストな鍵管理 |