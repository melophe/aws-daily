
# AWS関連キーワード集

## SMB (Server Message Block)

### 定義
**SMB = Server Message Block**

### 特徴
- **対象**: Windows系で主に使われるファイル共有プロトコル
- **機能**: ネットワーク越しにファイルやプリンタなどのリソースを共有する仕組み

### 用語の理解
- **SMBプロトコル**: ファイル共有のプロトコル
- **SMBファイル**: SMB共有に置かれているファイルを指す

## ファイルゲートウェイモード

**AWS Storage Gateway** というサービスの中のモードのひとつ

## SLA (Service Level Agreement)

### 定義
**SLA = サービス品質保証**

### 内容
- AWSが公式に「可用性を◯%以上保証します」と定めた数値
- **例**: SLA 99.99% → 年間のダウンタイムは約52分未満

## PoP (Point of Presence)

### 定義
**PoP = Point of Presence**

通信事業者やクラウド事業者が設置するネットワーク接続拠点

> インターネットや専用線を介してユーザーがクラウドに入る「入口」みたいなもの

### AWSにおけるPoPの例

#### 1. Site-to-Site VPN
- オンプレからAWSへVPNを張るとき
- AWS側のVPNエンドポイントがPoPに配置される

#### 2. Direct Connect
- AWS DXの接続先として、世界中のDXロケーション（PoP）が用意されている

#### 3. CloudFront/Global Accelerator
- エッジロケーション（これもPoPの一種）を通じてユーザーがAWSネットワークに入る

## ゼロトラスト

### 定義
**「すべてのアクセスを信用しない」ことを前提に設計するセキュリティモデル**

### 従来モデルとの違い

#### 従来のセキュリティモデル（境界防御モデル）
- 社内ネットワークに入ったら「信用できる」
- 社外から来たら「信用できない」
- **問題**: 「城と堀」型の考え方

#### ゼロトラストモデル
すべてのアクセスを検証・認証する

### ゼロトラストの4つの原則

#### 1. 認証・認可の徹底
- **IDベース制御**: IAM, SSO, MFA を活用
- **サービス間通信**: アプリやサービス同士の通信にも証明書や署名を利用
  - 例: App Mesh の mTLS

#### 2. 暗号化の徹底
- **通信暗号化**: 内部通信も含めて TLS で暗号化
- **データ保護**: 
  - at-rest（保存時）
  - in-transit（通信時）
  - 両方を保護

#### 3. 最小権限アクセス
- **必要最小限**: 必要なリソースにだけアクセスを許可
- **権限管理**: 使わないときは権限を取り消す

#### 4. 継続的な監視
- **監視ツール**: CloudWatch, GuardDuty, Security Hub などで常時モニタリング
- **即座対応**: 不審な挙動があれば即ブロック

## キャパシティプロバイダー

### 定義
**ECS に「どのキャパシティをどの割合で使うか」を教える設定**

### 機能
ECS サービスやタスクを起動するときに、自動でそのルールに従ってキャパシティを使い分ける

## Egress（外向き通信）

### 定義
- **egress** = 外向き通信
- **ingress**（内向き通信）に対する言葉
- **VPC の外**（インターネットや他のネットワーク）に出ていく通信のことを「egress」と呼ぶ

### egress VPC とは？

**インターネットへのアウトバウンド通信を一元的に管理するための専用 VPC**

#### 基本構成
- **アプリケーション VPC** は直接インターネットに出ない
- **代わりに egress VPC 経由でインターネットに出る**
- **セキュリティと監査を強化できる**

### 典型的な構成

#### アプリ VPC（Web/API サーバーやバッチがいる）
- **直接インターネットに出ない**
- **egress VPC に対して VPC Peering / Transit Gateway / PrivateLink で接続**

#### egress VPC（インターネット出口専用）
- **NAT Gateway / Firewall / Proxy を配置**
- **CloudTrail, VPC Flow Logs でモニタリング**
- **インターネットアクセスを集約管理**

### 使用する理由

#### セキュリティ統制
すべての外向き通信を egress VPC 経由にすることで、通信を可視化・制御できる

#### コスト最適化
NAT Gateway を各 VPC に置くより、1つの egress VPC にまとめたほうが安い場合がある

#### 監査対応
「どの通信が外に出ているか」を 1か所でログ監査できる

### アーキテクチャ図
```
App VPC1 ─┐
App VPC2 ─┼──> [Egress VPC] ──> Internet
App VPC3 ─┘
```

## Unicast vs Anycast

### Unicast（Elastic IPなど）の場合

- **IP アドレス** = 1つのサーバーやロードバランサーに直結
- **どこからアクセスしても、その特定リージョンまでトラフィックが行く**

#### 例: 東京に Elastic IP を持つ EC2
- **東京のユーザー** → 速い
- **アメリカのユーザー** → 東京まで遠回りなので遅い

### Anycast（Global Accelerator）の場合

- **IP アドレス** = 世界中で共通
- **最寄りの AWS エッジロケーションに吸い込まれ、そこから AWS バックボーンで目的のリージョンに最適ルーティング**

#### 例: Global Accelerator の Anycast IP
- **東京のユーザー** → 東京のエッジに入って東京リージョンへ
- **アメリカのユーザー** → アメリカのエッジに入ってバージニアリージョンへ

## ディザスタリカバリ（DR: Disaster Recovery）

### 定義

**システムに大規模障害（災害、データセンター障害、リージョン障害など）が発生したときに、業務を継続または迅速に復旧するために用意しておくバックアップ環境**

### DR環境の基本構成

#### 本番環境 (Production)
**通常稼働しているシステム**

#### DR環境 (Secondary / Backup site)
- **障害発生時に利用するシステム**
- **別のAZやリージョンに配置するのが一般的**

## AWSで使う代表的なDRサービス

### データレイヤー（データを守るサービス）

#### Amazon S3 + クロスリージョンレプリケーション (CRR)
バックアップデータや静的コンテンツを別リージョンに自動コピー

#### Amazon RDS / Aurora クロスリージョンリードレプリカ
- DBを別リージョンにリアルタイム or ほぼリアルタイムで複製
- 障害時はリードレプリカを昇格して利用

#### Amazon DynamoDB Global Tables
- 複数リージョンにまたがるマルチマスターDB
- どちらのリージョンでも読み書き可能

#### AWS Backup
EBS/RDS/DynamoDB/EFS などのバックアップを一元管理し、別リージョンにコピー

### アプリケーションレイヤー（計算・実行環境）

#### Amazon EC2 + AMI
DR用にAMIを保持しておき、必要時にEC2を起動

#### Auto Scaling Group
DRリージョン側でも自動でサーバーを起動できるようにする

#### Amazon ECS / EKS
コンテナベースのシステムなら、クラスタを両リージョンに用意しておく

#### AWS Elastic Beanstalk / CloudFormation / CDK
DR環境を自動的に立ち上げるための IaC（Infrastructure as Code）

### ネットワーク / 切替

#### Amazon Route 53 フェイルオーバーポリシー
- 本番環境が Unhealthy なら DR環境のエンドポイントを返す
- Active–Passive の典型

#### AWS Global Accelerator
- グローバルに低レイテンシでルーティング
- マルチリージョンDRに使える

### AWSでDR環境を作るときによく使うサービスまとめ

| レイヤー | サービス |
|----------|----------|
| **データ** | S3 CRR, RDSクロスリージョンレプリカ, DynamoDB Global Tables |
| **アプリ** | AMI, Auto Scaling, ECS/EKS, CloudFormation |
| **ネットワーク** | Route 53 フェイルオーバー, Global Accelerator |

## IPフローティング

### 定義

**障害発生時に「同じIPアドレスを別のサーバーに引き継ぐ」ことで、クライアント側は変更不要でフェイルオーバーできる仕組み**

- AWSなら **Elastic IP や ENI の再アタッチ**で同様の動きを実現

### IPフローティングの特徴

**ダウンタイムを最小化するための仕組み**

- **通常のフェイルオーバー**（例: Route 53 のDNS切替）は **DNSキャッシュ(TTL) の影響で切替に数十秒〜数分**かかる
- **IPフローティング**は**同じIPアドレスを別のサーバーに即座に付け替える**だけなので、クライアントは引き続き同じ宛先に接続できる

### 切替時間

**「監視が障害を検知する時間＋IPを移動させる時間」だけ（数秒〜十数秒レベル）**

### 制限事項

- **完全にゼロにはならない**
- **IP移動の間に一瞬だけ疎通が途切れる**（数秒程度の通信失敗はあり得る）
- **既存のTCPセッションは切れることが多い**（再接続は必要）
- **それでもDNS伝播待ちに比べたら大幅に短縮**

### AWSでの実装

#### Elastic IP (EIP)
**障害発生時に別のEC2へアタッチし直す** → 数秒で切替

#### ENI (Elastic Network Interface)
**セカンダリIPを別のインスタンスに移すことで同じ効果**

> どちらも「IPフローティング」と同じ仕組み

## フェイルオーバー方式の比較

### IPフローティング方式（EIP/ENIで実現）

#### 仕組み
**障害時に Elastic IP や ENI を別インスタンスに付け替える**

#### 特徴
- **数秒〜十数秒で切替**（DNS待ちは不要）
- **同じIPをクライアントが利用できる**

#### 制約
- **切替は同じリージョン内が前提**
- **自動化するなら Lambda＋CloudWatch Events などで仕組みを作る必要あり**

### Global Accelerator方式

#### 仕組み
**固定の Anycast IP を使い、AWSのグローバルネットワークで最適なエンドポイントに自動ルーティング**

#### 特徴
- **切替はほぼリアルタイム**（秒未満レベルのことも多い）
- **リージョンを跨いだ障害対応が可能**（東京→シンガポールなど）
- **DNSキャッシュの影響なし**

#### 制約
- **Route 53 やEIPより コストが高い**
- **主にグローバル配信やミッションクリティカルな用途向け**

## 使い分けのイメージ

### 同一リージョン内のインスタンス切替だけしたい
→ **EIP/ENIの付け替え（IPフローティング）で十分**

### マルチAZ/マルチリージョンで即時フェイルオーバーしたい
→ **Global Accelerator が有利**