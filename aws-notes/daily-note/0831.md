# AWS学習ノート - 8/31

## 1. DynamoDB関連

### キャパシティモード

#### オンデマンド
- 予約不要、リクエスト来た分だけ自動スケール
- 従量課金

#### プロビジョンド
- RCU/WCUを事前設定
- Auto Scaling Policyで調整可

#### リザーブドキャパシティ
- プロビジョンド専用の割引オプション
- 1年/3年契約

### インデックス

- **LSI**: 同じPKで別のSK。テーブル作成時のみ設定
- **GSI**: 別のPK/SKで検索。後付け可

### その他機能

- **Streams**: 変更イベントをLambdaやKinesisに流せる
- **TTL**: アイテムを期限で自動削除（ベストエフォート）
- **トランザクション**: 複数アイテムを一括整合性で更新（最大25件/4MB）
- **DAX**: インメモリキャッシュで読み取りを高速化

## 2. Auto Scaling関連

### スケーリング方式

- **手動スケーリング**
- **スケジュールベース**
- **ダイナミック**
  - **推奨**: ターゲット追跡（指定したメトリクスを維持するよう自動調整）

### スパイクとは？
急激なトラフィック増加。ターゲット追跡スケーリングはこういう突発的な負荷に強い。

### 最小・最大キャパシティ

Auto Scalingでは必ず設定する：

- **最小**: 絶対に維持する数
- **最大**: 増やせる上限

**例**: 最小=1にすれば「1台だけは常に起動」。落ちても再起動される

## 3. ネットワーク関連

### NAT Gateway

- **用途**: プライベートサブネットのインスタンスがインターネットに出るための出口
- **特徴**: アウトバウンド専用。インバウンド不可
- **デメリット**: 
  - 高い
  - 完全プライベート通信ではない（IGWを経由）
- **推奨**: S3やDynamoDBへのアクセスなら VPC Endpoint を使うべき

### VPC Endpoint

- **Gateway型**: S3/DynamoDB専用。ルートテーブルに設定
- **Interface型**: ENIとして配置。PrivateLinkでAWSサービスにプライベート接続

## 4. ストレージ関連

### EBSとRAID

- **RAID 0（ストライピング）**: 高速化。耐障害性なし
- **RAID 1（ミラーリング）**: 冗長性。容量効率50%
- **RAID 10**: 性能＋耐障害性。容量効率50%
- **RAID 5/6**: 非推奨

#### ストライピング
- データを分割して複数ディスクに並列処理
- 性能は上がるが、1本壊れたら全部アウト

### EFS vs FSx

- **EFS**: NFSベース。Linux向け。スケーラブル
- **FSx**: Windows向け（SMB）やLustre（HPC）。オンプレ環境とも連携しやすい

#### スクラッチファイルシステム
- 一時的に超高速ストレージを使う（分析やHPC）
- FSx for Lustre で「スクラッチ or 永続」モードを選べる

## 5. 分析/データ連携関連

### Hadoop
- 分散処理基盤
- AWSではEMRを使うのが一般的

### DataSync
- **用途**: オンプレ ↔ AWSストレージ（S3/EFS/FSx）間のデータ転送
- **注意**: EMRクラスターに直接は繋げない

### Lake Formation
- **概要**: データレイク管理サービス
- **データ保存**: データの実体はS3に置かれる
- **統合**: RDS/Redshiftとも統合可能（Glue Data Catalog経由）

### Glue JDBC接続
GlueからRDS/Aurora/Redshiftなどに接続し、ETL/クローリングが可能

## 6. アプリケーション関連

### App Mesh
- **概要**: サービスメッシュ。マイクロサービス間の通信を可視化・制御
- **機能**: 
  - トラフィック制御（Canaryリリース等）
  - モニタリング
  - mTLS暗号化
  - IAM/ACMと連携した証明書管理
- **特徴**: 複数の役割（ロードバランサー＋セキュリティ＋可観測性）をこなす

### ゼロトラスト
- **前提**: 「誰も信用しない」前提で設計
- **実現**: mTLS、IAM認証、最小権限、暗号化、継続監視

## 7. S3関連

### バケットポリシーのReferer条件
- 特定のドメイン（example.com / www.example.com）からのみアクセスを許可

## 8. 運用

### Q&A

**Q. バッチ処理とは？**  
A. データやジョブをまとめて一括処理する方式（夜間バッチなど）

**Q. AWSでのバッチ処理に使えるサービスは？**  
A. AWS Batch、Glue、EventBridge + Lambda

**Q. Service Catalogの役割は？**  
A. 標準化したAWSリソースセットを配布・利用管理できる。改変を防げる