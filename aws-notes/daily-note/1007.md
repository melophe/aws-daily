# API Gateway カスタムドメイン

## デフォルトのエンドポイント

通常、API Gateway のエンドポイントは
デフォルトでは以下のような AWSが発行したドメイン名になる：

```
https://abc123xyz.execute-api.ap-northeast-1.amazonaws.com/prod
```

## カスタムドメインを使うとどうなる？

API Gateway の「カスタムドメイン機能」を使うと、
自分の DNS ドメイン（例: `api.example.com`）を設定できるようになる。

設定すると、次のようなきれいなURLでアクセスできる：

```
https://api.example.com/
```

## 仕組み

### 1. カスタムドメインを作成（API Gatewayで設定）

例: `api.example.com`

ここで **ACM（AWS Certificate Manager）で SSL証明書を登録** する必要がある。

### 2. Route 53 など DNS サービスで CNAME/Aレコードを設定

`api.example.com` → API Gateway のエンドポイントを指すようにする。

### 3. Base Path Mapping（ベースパスマッピング）を設定

例: `/v1` → 特定の API ステージ (`prod` など) に紐づけ。

## 具体例

例えば、社内アンケートアプリのAPIを
`https://skills.example.corp/` で公開したい場合：

1. API Gateway に `skills.example.corp` をカスタムドメインとして登録
2. ACMで証明書（`skills.example.corp`）を発行
3. Route 53 で `skills.example.corp` の CNAME を API Gateway に向ける
4. Base Path Mapping で `prod` ステージをルート `/` に割り当て

結果: `https://skills.example.corp/submit` のようにきれいに呼び出せる

## API Gateway タイプごとのRoute 53設定

| API Gateway のタイプ | Route 53 での設定方法 |
|-------------------|---------------------|
| エッジ最適化 API (Edge-optimized) | CNAME を使う |
| リージョン API (Regional) | Aレコード（エイリアス）を使う |
| プライベート API (Private) | VPC内で使うため、Route 53 Private Hosted Zone に Aレコード設定 |

---

## CNAMEレコード

「このドメインは、別のドメイン名を指してます」と教える。

```
api.example.com.   CNAME   abc123.execute-api.ap-northeast-1.amazonaws.com
```

## ALIASレコード（AWS拡張版のAレコード）

AWS Route 53 が用意した Aレコードの拡張機能。
CNAME のように「別のドメイン名（例：CloudFront, API Gateway）」を指定できるのに、
Aレコードとして動作する。

```
example.com.  A (ALIAS)  d123.cloudfront.net.
```

- Route 53 が内部的に CloudFront のIPを解決してくれる
- ユーザー側は IP を書く必要なし
- ルートドメインでも使える！

---

## AWS Application Discovery Service エージェント

オンプレのサーバー（物理／仮想）にインストールして、
CPU・メモリ・ネットワーク・依存関係などを自動収集するエージェント。