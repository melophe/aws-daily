# Aurora Database Activity Streams (DAS)

## 概要

Aurora Database Activity Streams（DAS）は、データベースで発生するすべてのアクティビティ（クエリ、ログイン、DDL、DML など）をリアルタイムでストリーミングする機能。これにより、監査・コンプライアンス・不正検知などの目的で、Aurora の動きを外部システムに安全に転送できる。

---

# HIPAA コンプライアンス

HIPAA（ヒッパ）コンプライアンスとは、アメリカの医療データ保護法に準拠していることを意味する。

医療データ（患者の個人情報や診療情報など）を安全・機密に取り扱うための法律。

---

# S3 バッチオペレーション

S3 バッチオペレーションは、S3 オブジェクトに対して大規模なバッチ操作（新しいバケットへのコピーなど）を実行する機能。

## S3 で HIPAA データを保護する方法

### サーバーサイド暗号化（SSE）

S3 に保存するデータは必ず自動暗号化を有効にする。3種類あるが、HIPAA 対応ではほぼ SSE-KMS 一択。

| 種類 | 特徴 |
|------|------|
| SSE-S3 | AWS管理キー。簡単だが制御は限定的。 |
| SSE-KMS | AWS KMS キー（自社管理鍵可）で暗号化。監査ログやキーアクセス制御も可能。 |
| SSE-C | 自前の暗号鍵を渡す方式（複雑なので通常は非推奨）。 |

---

# DynamoDB のキャパシティユニット

## WCU (Write Capacity Unit) - 書き込みキャパシティユニット

- 1 WCU = 1秒あたり最大1KBのアイテムを1回書き込み
- 1KB を超える場合は追加の WCU が必要
- 例: 3KB のアイテム = 3 WCU

## RCU (Read Capacity Unit) - 読み取りキャパシティユニット

- 1 RCU = 1秒あたり最大4KBのアイテムを1回強整合性読み取り
- または 2回の結果整合性読み取り
- 4KB を超える場合は追加の RCU が必要
- 例: 10KB のアイテム = 3 RCU (強整合性)

## プロビジョニングモード (Provisioned Mode)

- WCU と RCU を手動で設定
- 予測可能なワークロードに適している
- Auto Scaling を有効にすることも可能
- コスト効率が良い（使用量が安定している場合）

---

# AWS X-Ray

AWS X-Ray とはアプリケーションのリクエストが複数の AWS サービスを経由する際の 流れを可視化・分析 するツール。

## 主な機能

### エンドツーエンドのトレーシング

- リクエストが通過した全サービスの経路を追跡
- レイテンシーやエラーを特定

### サービスマップ

- アプリケーションの構成要素（Lambda, API Gateway, DynamoDB など）の関係を視覚化
- ボトルネックを一目で発見

### パフォーマンス分析

- 各サービスの処理時間を測定
- どこで遅延が発生しているか特定

### エラー検出

- どのサービスでエラーが発生したか追跡
- 5xx エラー、スロットリングなどを可視化

---

# AWS X-Ray vs OpenTelemetry

## 共通点

- 分散システムのトレーシング
- リクエストの流れを可視化
- レイテンシーとエラーの特定
- サービス間の依存関係マップ

## 主な違い

| 項目 | AWS X-Ray | OpenTelemetry |
|---|---|---|
| 提供元 | AWS | CNCF（オープンソース） |
| ベンダーロックイン | AWS に依存 | ベンダー中立 |
| 対応環境 | AWS サービスに最適化 | マルチクラウド・オンプレ対応 |
| 統合の容易さ | AWS なら簡単 | 柔軟だが設定が複雑 |
| データ送信先 | X-Ray のみ | 複数バックエンド対応 |
| 標準化 | AWS 独自 | 業界標準 |

---

# OpenTelemetry

## 3つの柱

- **Traces（トレース）** - リクエストの流れ
- **Metrics（メトリクス）** - パフォーマンス指標
- **Logs（ログ）** - イベント記録

## 特徴

- **ベンダー中立**: Jaeger, Zipkin, Prometheus, AWS X-Ray など複数のバックエンドに送信可能
- **業界標準**: Google, Microsoft, AWS などが共同開発
- **言語サポート**: Java, Python, Go, Node.js など多数

---

# CORS

CORS (Cross-Origin Resource Sharing) = 異なるドメイン間でのリソース共有を許可する仕組み

---

# パーミッションセット (Permission Set)

パーミッションセット (Permission Set) は、AWS IAM Identity Centerでユーザーやグループに AWS アカウントへのアクセス権限を付与するためのテンプレート。

## パーミッションセットとは

簡単に言うと:

- IAM ロールのテンプレートのようなもの
- 複数の AWS アカウントに同じ権限を一括適用できる
- ユーザーがアクセスする際に一時的な認証情報を発行

## 従来の IAM との違い

| 項目 | 従来の IAM | IAM Identity Center のパーミッションセット |
|---|---|---|
| 管理場所 | 各 AWS アカウント | 中央管理（Identity Center） |
| 権限の配布 | アカウントごとに個別設定 | 複数アカウントに一括適用 |
| 認証情報 | 永続的（Access Key など） | 一時的（セッショントークン） |
| 用途 | 単一アカウント | マルチアカウント環境 |

## SSO とパーミッションセットの関係

**SSO (シングルサインオン) を可能にするもの:**
- IAM Identity Center 自体 + ID ソース（ユーザー管理）

**パーミッションセットの役割:**
- SSO 後に、どの AWS アカウントにどんな権限でアクセスできるかを定義

## フェデレーション後の権限定義

フェデレーションしたあとに、そのユーザーがなにできるかを定義するのがパーミッションセット。

**フェデレーション後の権限定義 = パーミッションセット**

## 認証・認可フロー

```
外部 IdP (Azure AD, Okta など)
  ↓
【フェデレーション (SSO)】← ここで認証
  ↓
IAM Identity Center
  ↓
【パーミッションセット】← ここで認可（何ができるか）
  ↓
AWS アカウントにアクセス
```