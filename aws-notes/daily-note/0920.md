# Route 53ルーティングポリシーの違い

## 1. 位置情報ルーティング (Geolocation Routing)

### 概要
ユーザーのIPアドレスの国/地域に基づいてルーティング

### 例
- 日本 → 東京リージョンのELB
- 韓国 → ソウルリージョンのELB

### 適用ケース
国ごとに強制的に分けたい場合はこれが正解 

## 2. 地理近接ルーティング (Geoproximity Routing)

### 概要
リソース（例えばELB）の地理的な場所に基づいてルーティング

### 判定基準
ユーザーの位置とリソースの位置の「距離感」で決まる

### 前提条件
Route 53 Traffic Flow（有料機能）が必要

### 特殊機能
「バイアス」を設定して、あるリージョンに多めに振ることも可能

### 例
東京とソウルにELBがあり、東京に+biasを設定 → 東京により多くトラフィックを誘導

---

# オンプレ-AWS VPN接続手順

## 設定手順
1. カスタマーゲートウェイ(CGW)を作成（オンプレのルーター情報を登録）
2. 仮想プライベートゲートウェイ(VGW)を作成しVPCにアタッチ
3. VPN接続を作成してCGWとVGWを関連付け
4. VPCルートテーブルにオンプレCIDRを追加
5. オンプレ側ルーターにAWSのVPN設定を反映

---

# RAID構成比較

| 目的 | 推奨RAID | 理由 |
|------|----------|------|
| **可用性向上・RTO短縮** | RAID 1 | 冗長性を重視 |
| **性能向上** | RAID 0 | 読み書きを高速化（ストライピング） |

# ACM証明書適用可能サービス

## Elastic Load Balancing (ELB)
- **ALB** (Application Load Balancer)
- **NLB** (Network Load Balancer、TLSリスナー使用時)
- **CLB** (Classic Load Balancer、HTTPSリスナー使用時)

## その他のサービス

### Amazon CloudFront
独自ドメインでのHTTPS配信に利用

### Amazon API Gateway
REST API, HTTP APIでカスタムドメイン設定時に利用

### AWS App Runner
カスタムドメインに適用可能

### AWS Elastic Beanstalk
ALBやCloudFrontを裏で使う形でACM適用

---

# Aurora レプリカ (Aurora Replica)

## 概要
同じリージョン内で高可用性・スケーラビリティを実現する仕組み

## 特徴
- 最大15個のAurora Replicaを作成可能
- レプリカは読み取り専用（リードレプリカ）
- 書き込みはプライマリインスタンスのみ
- フェイルオーバー時にはレプリカが昇格してプライマリになる
- リージョン内での高可用性 (HA) とリードスケーリングが目的

## ユースケース
- 読み取りトラフィックを分散させたい
- リージョン内での耐障害性を確保したい

---

# Aurora グローバルデータベース (Aurora Global Database)

## 概要
複数リージョン間での災害対策・レイテンシ改善用の仕組み

## 特徴
- プライマリリージョンのデータを1秒未満の遅延で読み取り専用レプリカリージョンに非同期レプリケーション
- リージョン間のデータコピーはAuroraのストレージレイヤーで処理されるので高速＆効率的
- 障害時には他リージョンのDBをプライマリに昇格可能（DR対応）
- レプリカリージョンは通常「読み取り専用」、昇格後は書き込み可能

## ユースケース
- 複数地域のユーザーに対して低レイテンシの読み取りを提供したい
- リージョン障害に備えたディザスタリカバリ (DR) を構築したい

---

# Aurora Replica vs Aurora Global Database 比較

| 特徴 | Aurora Replica | Aurora Global Database |
|------|----------------|------------------------|
| **範囲** | 同一リージョン内 | 複数リージョン間 |
| **用途** | 読み取りスケーリング / フェイルオーバー | 災害対策 (DR) / グローバル配信 |
| **書き込み可能** | プライマリのみ | プライマリリージョンのみ |
| **読み取り可能** | レプリカから可能 | 各リージョンのレプリカから可能 |
| **フェイルオーバー** | 数秒でプライマリ昇格 | リージョンを昇格（復旧時のDRシナリオ） |

# DNSレコード詳細

## Aレコード
- **機能**: ドメイン名 → IPv4アドレスの対応
- **例**: www.example.com → 203.0.113.10

## AAAAレコード
- **機能**: ドメイン名 → IPv6アドレスの対応
- **例**: api.example.com → 2001:db8::1234

## CNAMEレコード
- **機能**: ドメイン名 → 別のドメイン名の対応（エイリアス）
- **例**: app.example.com → myalb-123456.elb.amazonaws.com
- **注意**: CNAMEは「IP」ではなく「別の名前」を指す

## Aliasレコード (Route 53特有)
- **機能**: AWSのサービスを直接指せる特別なレコード
- **例**: 
  - www.example.com → CloudFrontのディストリビューション
  - api.example.com → ALB
- **特徴**: CNAMEっぽいけどZone Apex (example.com 直下) にも設定可能

---

## Hosted Zone 構成例

```
Hosted Zone: example.com
 ├── Aレコード      www.example.com → 203.0.113.10
 ├── CNAMEレコード  app.example.com → myalb-123.elb.amazonaws.com
 ├── MXレコード     example.com → mailserver.example.net
 └── TXTレコード    example.com → "spf=v=spf1 include:..."
```

### Hosted Zone の概念
- example.comのHosted Zoneを作ると、その中にいろんな種類のレコードを配置可能
- Hosted Zone = ドメインの「DNSレコードをしまう箱」でレコードの種類ごとに役割が異なる

---

## CNAME vs Alias 比較

| 特徴 | CNAME | Alias (Route 53限定) |
|------|-------|---------------------|
| **指す先** | どんなドメイン名でもOK | 主にAWSリソース (ALB, CF, S3 etc) |
| **ゾーンルート (example.com)** | ❌ 置けない | ✅ 置ける |
| **課金** | 通常のDNSクエリ課金 | 無料 (クエリ課金なし) |
| **IP変動への追従** | DNS委任先に依存 | AWSリソースなら自動で追従 |

### まとめ
- **CNAME** = 汎用的な「別名」
- **Alias** = AWSリソース専用の「スーパーCNAME」（ルートでも使える＆無料）

### Aliasレコードの対象

AWS が提供する「DNS名を持つリソース」

#### 対象リソース
- CloudFront
- ALB / NLB
- API Gateway
- S3 Website Endpoint
- VPC エンドポイント (一部)

---

## ACM 証明書適用先

### 概要
ACM 証明書は「カスタムドメイン名で公開される AWS リソース」にアタッチ

### 適用例

#### CloudFront
- www.example.com で配信

#### ALB (Application Load Balancer)
- https://app.example.com でアプリ公開

#### API Gateway
- REST API や HTTP API をカスタムドメインで公開

#### Elastic Beanstalk
- ロードバランサー付き構成

---

# Aurora レプリカと Global Database の違い

## Aurora レプリカ
- 同一リージョン内でリードレプリカを作成
- 読み取り分散、フェイルオーバー用

## Aurora Global Database
- 複数リージョンにまたがってレプリケーション
- 1秒未満の遅延で複製
- 災害対策やグローバル配信に使用

### 重要なポイント
Global Database は Aurora 専用。RDS標準にはなく、RDSは「クロスリージョンリードレプリカ」で代替

---

# Route 53 Hosted Zone

## 概要
ドメインのDNSレコードを管理する箱

## 管理可能なレコード
example.comの中に以下をまとめて管理:
- Aレコード（IPv4）
- CNAME（別名 → ALBなど）
- MX（メールサーバー）
- TXT（認証情報など）

## 種類
- **パブリックホストゾーン**: インターネット公開用
- **プライベートホストゾーン**: VPC内部だけ

---

# DNSレコードの種類まとめ

## 主なレコードタイプ
- **Aレコード**: ドメイン名 → IPv4
- **AAAAレコード**: ドメイン名 → IPv6
- **CNAME**: ドメイン名 → 別ドメイン名（AWSサービスのFQDNを指すことも多い）
- **Alias（Route 53特有）**: CloudFront / ALB / S3 などのAWSリソースを直接指定可能。ゾーンのルートにも配置可能

## 使い分け
- **CNAME**: 汎用エイリアス
- **Alias**: AWS専用スーパーCNAME

---

# Lambda と Route 53 / ACM

## Lambdaの制限
Lambda自体はDNS名を持たないため、Route 53 Alias レコードで直接指定不可

## Lambda公開方法
- **API Gateway**: DNS名あり、ACM証明書アタッチ可能
- **CloudFront + Lambda@Edge**

## ACM証明書適用ルール
- ACM証明書は「ドメイン名を持つリソース」にアタッチ（ALB、CloudFront、API Gatewayなど）
- S3単体にはアタッチ不可 → CloudFront経由で使用

---

# セキュリティグループとIP指定

## 基本概念
セキュリティグループは「誰からのアクセスを許可するか」を指定する仕組み

## 推奨設定例
**DBのSG** → **WebサーバーのSG**を指定して許可（推奨）

## 非推奨設定
DBのSGに「IPアドレスを指定」も可能だが、実務的でない

## ベストプラクティス
SGに「データベースのIPを指定」より、「呼び出し元SGを指定」が正しい

---

# NATゲートウェイとプライベートサブネット

## NATゲートウェイが必要なケース
プライベートサブネットのEC2がインターネットにアクセスしたい場合

### 設定方法
ルートテーブルでNATゲートウェイ（パブリックサブネットに配置）を指定

## NATゲートウェイが不要なケース
「ALB経由で外部から入ってくるだけ」の場合はNAT不要

---

# CloudFront + オンプレ

## 機能
カスタムオリジンとしてオンプレサーバーを指定可能

## メリット
海外ユーザー向けにキャッシュを効かせてレイテンシ改善が可能

---

# Storage Gateway vs DataSync

## Storage Gateway（File Gateway）
- **用途**: オンプレとS3を「共通ストレージ」のように使用
- **適用ケース**: 継続的にオンプレ＋クラウドを連携

## DataSync
- **用途**: 大量データを「移行」するための仕組み（SMB/NFS対応）
- **適用ケース**: 一度きりの大量移行

## 使い分け
- **一度きりの大量移行** → DataSync or Snowball
- **継続的な連携** → Storage Gateway

---

# Security Hub と Control Tower

## Security Hub
- **機能**: セキュリティベストプラクティス（CIS、FSBPなど）に基づきアカウントのセキュリティ状態を評価

## Control Tower + Account Factory
- **機能**: 新規アカウントをベストプラクティス設定付きで自動プロビジョニング

## 組み合わせのメリット
「新規アカウントをセキュリティガイドライン付きで展開 → Security Hubで監査」が可能

---

# DynamoDB

## 主な特徴
- **Streams + Global Tables**: 内部的にStreamsを使ってリージョン間レプリケーション
- **オートスケーリング**: キャパシティーモードで自動調整
- **リードレプリカなし**: 代わりにGlobal Tablesを使用

---

# Route Origin Authorization (ROA)

## 概要
IPアドレスをAWSに移行して使うための仕組み（BYOIP）

## 機能
「自社のIPアドレスをAWSでアナウンスして利用可能にする」

## 使用ケース
VPNやDirect Connect時にオンプレの既存IPをそのままAWSで使用可能

---

# VPCとDNS

## DNSホスト名設定
`enableDnsHostnames`を有効化しないとEC2にパブリックDNS名が割り当てられない

## 重要なポイント
- ENI（Elastic Network Interface）がIPを付与
- DNS名はVPCのオプション依存

---

# Redshift

## 拡張VPCルーティング
有効化するとCOPY/UNLOADがVPC内ルーティングに固定され、VPCフローログで監査可能

---

# 🎯 AWSサービス総まとめ

## データベースサービス
- Aurora Global DatabaseはAurora専用
- DynamoDB = AutoScalingあり、リードレプリカなし、Global Tablesは内部的にStreams使用

## ネットワークサービス
- Route 53 Hosted ZoneはDNSレコードの箱
- Alias = AWS専用CNAME
- セキュリティグループはIPではなくSG指定が基本
- NATはプライベートインスタンスが外へ出たい時だけ必要

## コンピュートサービス
- Lambdaには直接ACM証明書やAliasは使えない → API Gateway経由

## ストレージサービス
- Storage Gateway = 継続利用、DataSync = 移行

## セキュリティサービス
- Control Tower + Security Hubでセキュリティ自動化

---

# Route53 ルーティングポリシー詳細

## 概要
Route53には複数のルーティングポリシーが用意されており、これらを組み合わせることで複雑な要件に対応可能

## 主なポリシー

### 加重ルーティング (Weighted Routing)
新バージョンのアプリへ段階的にトラフィックを流す（カナリアリリース、ブルーグリーンデプロイ）

### レイテンシーベースルーティング (Latency-based Routing)
ユーザーに最も近いリージョンのエンドポイントへルーティング。グローバルなユーザー構成に有効

### 地理的位置ルーティング (Geolocation Routing)
国・地域ごとに異なるサービスやコンテンツを配信。法規制対応やリージョン限定サービスに利用

### 地理的近接性ルーティング (Geoproximity Routing + Traffic Flow)
距離と重み付けに基づき、ユーザーを特定リージョンに誘導。複数データセンターを柔軟に活用可能

### フェイルオーバールーティング (Failover Routing)
- プライマリ障害時に自動でセカンダリへ切替
- 高可用性を確保

---

## Route53 Traffic Flow 活用

### 概要
Route53 Traffic Flow は、GUIベースでポリシーを組み合わせられる強力な機能

### 特徴
- 複数のルーティングポリシーを**ツリー構造（ポリシーツリー）**として定義可能

### 実装例
ユーザーの地域を判定 → 該当地域内でレイテンシーベースルーティング → 新旧システムに加重ルーティング

### メリット
- 複雑な条件分岐を管理画面から可視化・運用できる
- 複雑な組織構造・ユーザー構成に対しては Traffic Flow が最適解

## Traffic Flow でのポリシー組み合わせ

### 重要な制約
Traffic Flowを使わずに複数のルーティングポリシーを直接組み合わせることは不可能

### 使い分け
- **単一ポリシー**: Traffic Flowなしでも設定可能
- **複数ポリシーを階層的に組み合わせ**: Traffic Flow必須

### Traffic Flowなしの制約
1つのレコードに対して1種類のポリシーしか選択不可

---

# Active Directory 統合パターン

## 本格的統合
オンプレADとAWSのユーザー管理を本格的に統合したい場合:
- **AWS Managed Microsoft AD** を使用
- オンプレADと信頼関係を構築

## 既存AD活用
オンプレADをそのまま使いたい場合（AWSにAD新設なし）:
- **AD Connector** を利用
- AWSサービスからオンプレADへ認証を委譲

## サービス比較
- **AD Connector** = プロキシ、ADを作らない
- **AWS Managed Microsoft AD** = AWS上にマネージドADを構築し、オンプレADとトラストを張れる

---

## AWS Managed Microsoft AD

### 概要
AWS上にマネージドなMicrosoft Active Directoryを構築するサービス

### 特徴
- ユーザーがドメインコントローラを立てて管理する必要なし
- AWSが運用・パッチ管理を実施
- 完全にAWS内に新しい ADドメイン を持つ

### オンプレADの必要性
- **必須ではない**: 単体で利用可能
- オンプレにADがなくてもAWS Managed Microsoft ADだけでディレクトリ基盤を構築可能
- AWS上のアプリ（EC2、RDS、WorkSpacesなど）でユーザー認証が可能

### オンプレADとの連携
- AWS Managed Microsoft AD と **信頼関係 (trust relationship)** を構築可能
- オンプレADのユーザーがAWSのリソースへシングルサインオン実現
- 移行フェーズやハイブリッド構成でよく使われるパターン

## まとめ
- **AD Connector** = 既存のオンプレADをそのまま利用するための中継役
- **Managed Microsoft AD** = AWS上に新規にマネージドADを構築できるサービス

---

# EC2 サービスクォータ制限

### 制限の単位
AWSのEC2リソース制限（サービスクォータ）は、インスタンス数ではなく「vCPUの総数」で決定

### 計算例
東京リージョンで「オンデマンドインスタンス vCPU の上限 = 64」の場合:
- m5.large（vCPU 2）を 10台 → 20 vCPU
- c5.4xlarge（vCPU 16）を 4台 → 64 vCPU

### vCPU数で制限する理由

#### 公平性の確保
- インスタンスサイズによって消費するCPUリソースが異なる
- 「インスタンス数」で制限すると、t3.micro 100台と m5.24xlarge 1台が同じ扱いになり不公平

#### 統一管理
AWSは CPUリソースの単位を「vCPU」に統一して管理

### 制限到達時の動作
上限に達している場合、それ以上インスタンスは起動不可

### 計算方法
インスタンスを増やす際は「そのインスタンスの vCPU × 台数」で消費量を計算し、リージョンごとの上限を超えると起動不可

### 補足情報
- 手動やASGでインスタンスを増やすときは「インスタンスのvCPU × 台数」で消費量を計算
- リージョンごとの上限を超えると起動不可
- インスタンス起動の制限は「インスタンス数」ではなく「vCPU数の合計」

### インスタンスタイプとvCPU例
- t3.micro → vCPU 2
- m5.large → vCPU 2
- c5.2xlarge → vCPU 8
- m5.4xlarge → vCPU 16

### デフォルト制限例
東京リージョンではデフォルトでオンデマンドインスタンスのvCPUは64までという制限があるケースが多い

---

# AWS Glue Sensitive Data Detection

## 概要
AWS Glue Data Catalogにデータを取り込むときや、GlueのETLジョブを実行する際に、データ中に含まれる機密情報（PII: Personally Identifiable Informationなど）を自動検出できる機能

## 機能例
CSVやParquet、JSONといったS3上のデータセットをスキャンしながら「氏名」「メールアドレス」「クレジットカード番号」などのパターンを認識

## 主な機能

### パターンベース検出
クレジットカード番号、電話番号、SSN（米国社会保障番号）、氏名など、一般的なPIIパターンをサポート

### カスタム検出ルール
正規表現などを利用して独自の機密データパターンも検出可能

### カタログ統合
- データカタログのメタデータに「このカラムはPIIを含む」といった情報を付与可能
- ダウンストリームでAthenaやRedshift Spectrumからクエリする際に機密カラムを特定しやすい

### コスト効率
Glueのスキャン処理に組み込む形なので、既存のETL/カタログ処理と統合可能

---

## Amazon Macie との違い

### Glue Sensitive Data Detection
- Glueジョブやカタログ作成の「処理の中で検出」
- 検出結果をカタログに紐づけて管理
- データレイク処理の流れの一部として便利

### Amazon Macie
- S3全体を対象に自動スキャン
- 継続的な監視やセキュリティレポートに強い
- セキュリティサービスとしての性格が強い

---

# AWS Lake Formation データ共有方法

## 概要
Lake Formationで「外部（他アカウント・他企業）とデータ共有」するには、2つの主な方法がある

1. Lake Formation のクロスアカウント共有機能

Lake Formation の「データ共有 (Data Sharing)」機能を使って、
テーブル単位・カラム単位 で別の AWS アカウントにデータを共有できます。

共有先は AWSアカウントID を指定するので、外部企業がAWSを使っているなら直接共有可能。

メリット:

カタログベースでの細粒度アクセス制御

相手側は自分のアカウントの Data Catalog からクエリ可能（Athena, Redshift Spectrum, EMR など）

デメリット:

相手が AWS を利用していることが前提

 2. AWS Data Exchange を活用

自社データを「プロダクト」として登録し、外部企業に提供できる仕組み。

単なる AWS アカウント間共有ではなく、契約ベース／マーケットプレイス型のデータ配布 を実現できる。

相手が自分のAWSアカウントにデータをインポートして利用可能。

メリット:

商用データ配布に強い（課金・契約が組み込める）

外部パートナーや顧客とデータを広く共有できる

デメリット:

シンプルなクロスアカウント共有よりはセットアップが複雑

---

## Firehose 機能

### 入力データ
- アプリやKinesis Data Streamsから流れてくるストリーミングデータ
- CloudWatch LogsやIoT Coreのストリームデータ

### 変換処理

#### Record Format Conversion 機能
自動で以下のように変換可能:
- JSON → Parquet
- JSON → ORC
- JSON → CSV（※変換はLambda経由で実装可能）

#### カスタム変換
AWS Lambda を連携させることで任意の変換ロジックを挟むことも可能

### 保存先
- Amazon S3
- Amazon Redshift（COPYコマンドでロード）
- Amazon OpenSearch Service
- Splunk など

---

## Kinesis Data Streams 制限

### S3保存について
Kinesis Data Streams 単体では S3 に直接保存不可

### 必要な組み合わせ
Firehose や Lambda を組み合わせる必要がある

AWS Transfer Familyとは

SFTP/FTPS/FTP 経由でファイルを転送できるマネージドサービス。

従来オンプレミスや企業間でよく使われている ファイル転送プロトコル をそのままクラウド上に持ち込み、
Amazon S3 や Amazon EFS に直接保存できる のがポイント。

 主な特徴

従来のプロトコル対応

SFTP (Secure File Transfer Protocol)

FTPS (FTP over SSL)

FTP (非暗号化、推奨されない)

保存先

Amazon S3

Amazon EFS

受信したファイルは即座にデータレイクや分析基盤に利用可能

セキュリティ・認証

AWS IAM または Active Directory 連携でユーザー認証可能

VPCエンドポイント経由でプライベート転送も可能

完全マネージド

従来はSFTPサーバーを自分でEC2に立てて運用する必要があったが、その手間が不要

高可用性・スケーラブルに動作

 典型的なユースケース

取引先からのデータファイルを SFTPで受け取り、そのままS3に保存

オンプレシステムがFTPでしか送信できない → Transfer Familyをゲートウェイとして利用

ファイル転送を自動化し、S3に保存されたファイルを Glue/Athena/Redshiftで分析

 まとめ

AWS Transfer Family = 企業で昔から使われてきたSFTP/FTPサーバーをAWSマネージドで提供するサービス

保存先は S3またはEFS

「古い仕組み（SFTP/FTP）」と「新しい仕組み（クラウド・データレイク）」をつなぐ架け橋

Datasync
オンプレからデータを送るなら → 毎回 DataSyncエージェントが必要

AWS内のサービス間コピーなら → エージェント不要

File Gateway

用途: オンプレから S3 をファイル共有（NAS風）で使う

プロトコル: NFS, SMB をサポート

特徴:

オンプレアプリから「普通のファイル共有」としてアクセスできる

データは S3 にオブジェクトとして保存され、オンプレにはキャッシュが残る

S3 のネイティブなオブジェクト形式（プレフィックスやライフサイクル管理）がそのまま利用できる

ユースケース:

研究データ、ログファイル、分析基盤への入力データ

オンプレアプリがファイル共有しか使えない場合の S3 ブリッジ

 Volume Gateway

用途: オンプレのブロックストレージ（iSCSI）をクラウド連携

プロトコル: iSCSI (ブロックデバイスとして提供)

モード:

Cached Volume モード

頻繁に使うデータはオンプレにキャッシュ

マスターコピーはS3に保存

Stored Volume モード

データの完全コピーはオンプレに保持

非同期でS3にバックアップ（EBSスナップショットとして保存）

ユースケース:

オンプレのサーバーがブロックストレージ（ディスク）としてしか扱えない

ディザスタリカバリ（オンプレ障害時にEBSスナップショットから復旧）

NFS と SMB とは？
1. NFS (Network File System)

主に Linux/UNIX 系でよく使われるファイル共有プロトコル。

ネットワーク越しにファイルをやり取りする仕組み。

例: 大学の研究室で複数のLinuxサーバーが同じデータをNFSでマウントして使う。

2. SMB (Server Message Block)

主に Windows 系で使われるファイル共有プロトコル。

「\共有サーバー\フォルダ」の形でアクセスするイメージ。

Windowsクライアントや研究用PCがファイルサーバーにアクセスする時によく使う。

---

## Amazon SNS 通知特徴

### Pub/Sub モデル
- 1つのトピックに対して複数のサブスクライバー（HTTP/S, SQS, Lambda, メールなど）を設定可能

### 一斉配信が基本
- 同じメッセージがサブスクライバー全員に届く
- 店舗ごとに「条件分岐して別の内容を送る」ような細かい制御は不可能
- SNS単体では「店舗Aにはこの内容、店舗Bには別内容」といったカスタム通知は不可能

---

## Amazon SES 特徴

### メール送信専用サービス
- 個別ユーザーや特定店舗に対して動的に生成したカスタムメールを送信可能
- アプリケーションロジックで「どの店舗に、どんな内容を送るか」を組み立てて SES から送信可能

---

## 解決アーキテクチャパターン

### 一斉通知で十分な場合
- SNS トピックを使用
- 各店舗はサブスクライバーになる

### 店舗ごとに違う内容を送りたい場合
- SNS ではなくアプリケーション側で制御 → 必要な情報を組み立てて SES で送信
- または、SNS → Lambda を挟み、Lambda で店舗ごとに内容を変えて SES 経由で送信

### 使い分けまとめ
- **一斉通知** → SNS が正解
- **個別通知（内容が違う）** → SES が正解

AWS Direct Connect の基本

オンプレ ↔ AWS VPC を 専用線でつなぐサービス

接続先は通常「VPCの Virtual Private Gateway (VGW)」または「Transit Gateway」

 Direct Connect Gateway (DXGW) の役割

複数のVPCやリージョンと接続したいときに使うゲートウェイ

通常の VGW では「同じリージョンの1つのVPC」にしか接続できない制約がある

そこで DXGW を使うと：

複数のVPCに接続できる

リージョンをまたいで接続できる

### SageMaker サービス比較表

| サービス | 対象ユーザー | 特徴 |
|----------|-------------|------|
| **SageMaker Canvas** | ビジネスユーザー / 分析担当者 | ノーコードで予測モデルを作れるGUI |
| **SageMaker Studio** | データサイエンティスト / MLエンジニア | コードベースの本格的なML開発IDE |

---

## RDS バックアップ管理

### 1. RDS 自動バックアップ
- 自動バックアップの保持期間は最大35日まで設定可能
- 保持30日の要件は自動バックアップだけで満たせる
- ただし「自動バックアップのみ」の制限

### 2. 手動スナップショット
- デフォルトでは削除しない限り無期限に保存
- 30日で自動削除はされないので管理が必要

### 3. 最適な解決方法

#### AWS Backup 利用
- RDSの自動バックアップ＋手動スナップショット両方を対象にできる
- バックアッププランで保持期間を30日に設定すれば自動削除
- マルチAZ冗長化も継続利用でき、かつコストを抑制可能

---

## ALB DDoS 攻撃対策

### ALB の制限
ALB 単体では不特定IPからのDDoS攻撃は防御不可

### 必要なソリューション
- **AWS Shield**（標準は自動付帯、必要に応じてAdvanced）
- **AWS WAF**（レート制限やIPレピュテーションで制御）

---

## Storage Gateway ファイル系サービス比較

### File Gateway (S3用)
- S3 をオンプレからファイル共有として使用

### FSx File Gateway (FSx用)
- FSx for Windows File Server をオンプレから使用

### まとめ
両方とも「Storage Gatewayのファイル系サービス」だが、裏側のストレージが S3 か FSx かの違い

---

## DynamoDB Export to S3 制限

### 条件指定エクスポート
以下のような条件を指定して部分的にエクスポートすることは不可能:
- 特定の属性（例: created_at）
- 条件（例: created_at >= 2024-01-01）

### エクスポート対象
必ずテーブル全体または特定時点のスナップショット全体がエクスポート対象

---

## AWS Transfer Family 詳細

### 概要
AWSがマネージドで提供するファイル転送サービス（旧AWS Transfer for SFTP）

### サポートプロトコル
SFTP / FTPS / FTP をサポート

### メリット
ユーザーはサーバー管理不要（EC2でSFTPサーバーを立てたり、OSパッチ管理をする必要なし）

### アーキテクチャ
- インスタンスを直接立てるわけではない
- AWS がマネージドで用意するエンドポイント（サービス）を提供

### ネットワーク接続オプション
- **インターネット経由**（Public endpoint）
- **VPC内に配置**（VPC endpoint）

### データフロー
```
[外部パートナー] --SFTP/FTPS/FTP--> [AWS Transfer Family Endpoint]
                                           |
                                           v
                                     [S3 or EFS]
```

---

## EBS 制限

EBSはEC2専用

---

## AWS Storage Gateway モード比較

### File Gateway (S3 File Gateway)
- **機能**: S3 を NFS/SMB で見せる
- **保存先**: Amazon S3 バケット
- **ユースケース**: S3にバックアップ保存、ログ集約、アーカイブ

### FSx File Gateway
- **機能**: FSx (Windows File Server や Lustre) をオンプレに SMB で見せる
- **保存先**: Amazon FSx
- **ユースケース**: オンプレとAWS間で Windows ファイル共有を統合

---

## FSx for Lustre ストレージタイプ

### 1. Scratch File System（スクラッチ）

#### 用途
一時的・短期間の利用向け

#### 特徴
- 高スループット
- 短期的に大量のデータ処理に最適
- 冗長化はされない（障害時にデータ消失可能性あり）

#### ユースケース
- 一時的な分析ジョブ
- シミュレーション結果やデータ変換処理

### 2. Persistent File System（パーシステント）

#### 用途
長期利用・高可用性向け

#### 特徴
- データが冗長化されて保持
- 障害が起きても復旧可能
- 継続的な利用に適している

#### ユースケース
- 本番系のHPCアプリケーション
- データレイクとの統合（S3連携）
- 継続的に使う研究/分析環境