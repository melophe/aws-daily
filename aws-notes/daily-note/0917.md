# IoT データ処理フロー

## 基本構成

1. IoT デバイス
2. Amazon Kinesis Data Streams（データ収集・取り込み）
3. Amazon Managed Service for Apache Flink（リアルタイムクエリ、時系列分割）
4. Amazon S3（または Timestream）に保存

## 重要なポイント

- Flink から直接 S3 に書き込めるので Firehose は不要

## 使い分け

- **リアルタイム処理あり** → Flink → S3 で十分 ✅
- **処理なしでストレージ保存だけ** → Firehose を使う

---

# SCP (Service Control Policy) の仕組み

## SCP例

```json
{
  "Effect": "Allow",
  "Action": [
    "ec2:*",
    "iam:*",
    "cloudwatch:*"
  ],
  "Resource": "*"
}
```

これは「EC2・IAM・CloudWatchに関しては操作していいよ」という最大許可枠を定義しているだけ

## 重要なポイント

- **SCPだけでは実際の操作はできない**
- **実際に操作するには IAMポリシーでも許可されている必要がある**

### 基本原則

**SCP = 上限、IAMポリシー = 実際の権限**

## 動作パターン

### パターン1: SCP許可、IAM未許可
- SCPで「EC2:*」を許可
- でもIAMポリシーでEC2許可がなければ → **操作できない**

### パターン2: SCP拒否、IAM許可
- SCPで「EC2:*」を拒否
- IAMポリシーでEC2許可してても → **操作できない**

### パターン3: 両方許可
- SCPで「EC2:*」を許可 + IAMポリシーで「EC2:*」を許可
- 初めて実際に操作できる ✅