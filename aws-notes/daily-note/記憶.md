# AWS 学習メモ

## SFTP とデータ転送

- SFTP = SSH を使った安全なファイル転送プロトコル
- DataSync = NFS/SMB/HDFS/S3/EFS/FSx 専用（SFTPは対象外）
- SFTPを扱うなら AWS Transfer Family を使うのがベスト

---

## データベース移行

- AWS DMS = データベース移行サービス
- スキーマ変換には AWS SCT を併用

---

## CloudFormation

### 変更管理
変更セットは事前に確認すること

### 参照方法
- 同じスタック内: Ref, Fn::GetAtt
- 別スタック間: Export / ImportValue

---

## AWS Organizations

AWS Organizations を作成した直後は、「FullAWSAccess」 という SCP が全 OU とアカウントにアタッチされている

- FullAWSAccess = すべてのサービス／アクションを許可
- SCP は「この範囲までしか許可できない」という上限

---

## ネットワーク・セキュリティ

### ポート番号
1433番: Microsoft SQL Server (MSSQL) がデフォルトで使う TCP ポート番号

### エフェメラルポート
クライアントがサーバーに通信するときに 一時的に自動割り当てされるポート番号

---

## CloudFront

cloudfrontには価格クラスがあり高いほど速くなる

---

## AWS ParallelCluster

スーパーコンピュータ環境をAWS上で作るためのサービス

---

## DynamoDB トランザクション

### 基本機能
- 複数操作をまとめて1つのトランザクションに
- 最大 25 個の操作をまとめられる
- 複数テーブルにまたがってもOK
- ACID 特性

### 実用例
DynamoDBテーブルに対して複数の項目の追加、更新、または削除を一つのオペレーションとして管理できるワークフローを作れる

例：
- 「新しいアイテムを追加する (Put)」
- 「もし機密フラグが立っていたら削除する (ConditionCheck + Delete)」

これらを1つのトランザクションにまとめることで、中途半端な状態が残らない

---

## SQS 優先度制御

複数キューを作って、それを優先度付きのように扱う

### 構成例
- 有料ユーザー用 → HighPriorityQueue
- 無料ユーザー用 → StandardQueue

### 処理ロジック
1. HighPriorityQueue を優先的にポーリングする
2. 空なら StandardQueue を処理する

---

## S3データ転送の高速化

Amazon S3 Transfer Acceleration

---

## ACM 証明書

ACM を利用する場合、EC2にインストールするのではなくELBにインストール

---

## NACL の挙動

### デフォルトNACL
- Inbound / Outbound ともに すべて許可 (Allow All)
- だから特に何もしなくても通信できる

### カスタムNACL
- Inbound / Outbound のルールを自分で書く必要がある
- ステートレスなので 行きと戻りを両方許可しないと通信不可
- つまり「Inboundだけ許可してもNG」

### SSHの場合
- Inbound: ポート22を許可
- Outbound: クライアントのエフェメラルポート(1024–65535)を許可

両方そろって初めてSSHがつながる

ステートレス！

---

## Redshift

### WorkLoad Management
Redshift でクエリを効率的に処理するための クエリキュー管理システム

クエリを「キュー」に入れて、リソース（メモリ・並列実行枠）を配分

---

## その他

### DMS vs SCT
- DMS = データ移行
- SCT = スキーマ変換

### PrivateLink 接続条件
「サードパーティのアプリが AWS 上にある」＋「プライベートに接続したい」＋「インターネット接続は最小限」 という条件

---

## IOPS について

### 定義
IOPS = Input/Output Operations Per Second

1秒あたりの入出力処理回数

### 補足
- 「IO」= 入出力を意味する
- 「io1 / io2」= 高IOPSを提供するSSD

### SQS アクセスポリシー
- SQS → アクセスポリシー必要（どのサービスからメッセージ受け取れるか明示する）

### CloudFormationのEgressの意味
- Egress: true → アウトバウンドルール（送信）
- Egress: false → インバウンドルール（受信）

### Amazon IVS vs AWS Elemental

#### Amazon IVS
- ライブ配信に特化、超低遅延
- 開発者向けに「配信機能をアプリに組み込む」用途

#### AWS Elemental MediaLive / MediaPackage
- 本格的な映像配信プラットフォーム構築向け

### Container Insights と X-Ray の併用
- Container Insights で「Pod に余裕があるのに遅いな？」と気づき、X-Ray で「サービス間の呼び出しが遅い」と特定する

### レイヤーの違い

#### CloudWatch Container Insights
- 見ているのは インフラ／コンテナリソースのレイヤー
- 例えば：
  - Pod がメモリ 95% 消費
  - Node の CPU が 80% で逼迫
  - ネットワーク I/O が増えてる
- 粗い粒度（インフラやコンテナ単位） での状況把握に強い

#### AWS X-Ray
- 見ているのは アプリケーションリクエストのレイヤー（分散トレーシング）
- 例えば：
  - API Gateway → Auth Service → Order Service → DB という呼び出し経路
  - Order Service 内の「SQL 実行」が 1.2 秒かかっている
  - 外部 API 呼び出しが失敗している
- より細かい粒度（リクエストごと・処理ステップごと） での可視化ができる

### AppFlow
- サードパーティ SaaS（Salesforce, Slack, Zendesk, ServiceNow など）との連携 = AppFlowかもとなる

AWS Global Accelerator

AWS グローバルネットワークを使って、世界中から ALB/NLB/EC2 へのアクセスを最適化

エニーキャスト IP による最短経路ルーティング & 可用性向上

直接構成できるのは ALB または NLB

ただし推奨されるのは NLBとの統合（レイヤー的に自然かつ高速）

cron方式 = 「スケジューラ専用の EC2 サーバーを常時稼働」させないといけない
→ インスタンス代が発生し、管理も必要

Lambda + EventBridge 方式 = 「AWSのマネージドなスケジューラ（EventBridge）が Lambda を呼び出す」
→ サーバーレスなので余計なEC2が不要

DynamoDB のキャパシティーモード

プロビジョンド（固定キャパシティー）

ベースラインは安いが、スパイクに弱い

Auto Scaling を有効化すると多少は追従可能だが、スパイクに完全には対応しきれないことがある

オンデマンド（従量課金）

リクエストに応じて自動スケーリング

スパイクに即応できる（数百万 RCU/WCU まで対応可能）

「使った分だけ課金」なので、普段は低負荷・時々スパイクのケースでコスト効率が高い

### DynamoDB スケーリングの違い
- dynamodbのAuto Scaling = プロビジョンドモード専用の機能　反応は数分かかるので、急なスパイクには弱い
- オンデマンドモード = Auto Scaling 不要、完全自動

---

### FSBP (Foundational Security Best Practices)
- AWS が提供している セキュリティベストプラクティス基準
- AWS Security Hub で有効化できるセキュリティ標準の 1 つ
- AWS アカウントやリソースがベストプラクティスに従っているかどうかを自動チェック

### OLTP vs OLAP
- **OLTP (Online Transaction Processing)**: 日常業務向け（トランザクションを速く正確に処理）
- **OLAP (Online Analytical Processing)**: データ分析向け（大量データを集計・解析）

### Storage Gateway
- **キャッシュ型ボリュームゲートウェイ**: プライマリーはS3ストレージ
- **ボリュームゲートウェイ**: プライマリーはオンプレミスストレージ

### Apache Flink vs Firehose

リアルタイムでクエリ処理 = Amazon Managed Service for Apache Flink

- Flinkから直接S3に書き込める
- Firehoseは不要

#### 使い分け
- リアルタイム処理あり → Flink → S3 で十分
- 処理なしでストレージ保存だけ → Firehose を使う

---

### SCP vs IAM ポリシー

- SCP = 「何をやってもいいかの上限」
- IAMポリシー = 「実際にやっていい操作」

#### 重要な制約
- SCPだけでは実際の操作はできない
- 実際に操作するには IAMポリシーでも許可されている必要がある

Customer Gateway (CGW) = オンプレ側のVPNルーターをAWSに登録した論理的リソース

Virtual Private Gateway (VGW)

VPCにアタッチして、VPNのAWS側の入り口

Transit Gateway (TGW)

複数VPCやオンプレをまとめて接続できるハブ

CGW（オンプレ） ↔ VGW/TGW（AWS）でSite-to-Site VPNが張られる

---

### データ移行サービスの違い

#### Storage Gateway
- 「オンプレとAWSストレージをつなぐブリッジ」
- データ移行の専用サービスではない
- 継続的に「オンプレとクラウドを共通ストレージのように扱う」ためのサービス

#### DataSync
一度データをAWSに「移行」するためのサービス

#### 使い分け
- **大量データを一度移行したい** → DataSync or Snowball
- **オンプレとS3をシームレスに使いたい** → Storage Gateway (File Gateway)

#### 選択基準
- 「ネットで転送できるなら DataSync、ネットじゃ無理なら Snowball」
- 「100TB超えて帯域不足なら Snowball Edge、それ以上なら Snowmobile」

---

### Amazon FSx

#### 概要
マネージドファイルシステムの総称

#### サービス別用途
- **Windows環境** → FSx for Windows File Server
- **HPCやS3連携** → FSx for Lustre
- **エンタープライズNetApp** → FSx for ONTAP
- **Linux/ZFSワークロード** → FSx for OpenZFS