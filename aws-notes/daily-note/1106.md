# EC2 Instance Connect

EC2 Instance Connectは、PEMキー（秘密鍵ファイル）を手元に持っていなくても、EC2インスタンスにSSH接続できる機能。

## 仕組み

- AWSコンソールのブラウザベースのSSHクライアントから直接接続可能
- AWS CLIを使用してコマンドラインから接続可能
- 接続時に、AWSが一時的な公開鍵をインスタンスにプッシュする（60秒間有効）
- IAMの認証情報を使用してアクセス制御を行う

## 利点

| 項目 | 内容 |
|---|---|
| PEMキーの管理が不要 | 秘密鍵ファイルを保管・管理する必要がない |
| セキュリティ向上 | キーが漏洩するリスクが減る |
| アクセス制御 | IAMポリシーで誰がどのインスタンスにアクセスできるか細かく制御可能 |
| 監査 | CloudTrailでアクセスログを記録可能 |

---

# Route 53 と Route 53 Resolver

Amazon Route 53 Resolver エンドポイントを VPC 内に作成することで、AWS とオンプレミス環境間の DNS 名前解決が可能になる。

## Route 53（通常のRoute 53）

パブリックDNSサービスとして機能：

- インターネット上のドメイン名の管理とDNS解決
- ドメイン登録
- パブリックホストゾーンの管理
- 外部からアクセス可能なリソース（Webサイト、APIなど）への名前解決

## Route 53 Resolver

VPC内のDNS解決に特化したサービス：

- VPC内のリソース間でのDNS解決を処理
- デフォルトでは、すべてのVPCに自動的に提供される（VPC+2のIPアドレス）
- ハイブリッド環境での名前解決が主な用途

## Route 53 Resolverの主な機能

### Inbound Endpoints（インバウンドエンドポイント）

- オンプレミスのネットワークからVPC内のリソースの名前解決を可能にする
- オンプレミス → AWS方向のDNSクエリ

### Outbound Endpoints（アウトバウンドエンドポイント）

- VPCからオンプレミスや他のネットワークのリソースの名前解決を可能にする
- AWS → オンプレミス方向のDNSクエリ

### Resolver Rules（リゾルバールール）

- 特定のドメインに対するDNSクエリを、指定したDNSサーバーに転送するルールを設定

## 使い分けの例

| サービス | 用途例 |
|---|---|
| Route 53 | 「example.com」という公開Webサイトのドメインを管理 |
| Route 53 Resolver | VPC内のEC2インスタンスから社内のオンプレミスサーバー「server.corp.local」にアクセスする際の名前解決 |

**まとめ:** Route 53はパブリックなインターネット向け、Route 53 Resolverはプライベートなハイブリッドネットワーク環境向けのDNSサービス。

---

# エンドポイントの所属

インバウンドエンドポイントとアウトバウンドエンドポイントは、Route 53 Resolverの機能。

## 普通のRoute 53

- エンドポイントという概念はない
- パブリックDNSとして、インターネット上でドメイン名を解決するだけ

## Route 53 Resolver

- インバウンドエンドポイント、アウトバウンドエンドポイントを作成可能
- これらを使ってハイブリッド環境でのDNS解決を実現

## エンドポイントの役割

### インバウンドエンドポイント

- **方向:** オンプレミス → AWS VPC へのDNSクエリ
- **用途:** オンプレミスのサーバーが「ec2-instance.internal」のようなVPC内のリソースを名前解決したい場合に使用

### アウトバウンドエンドポイント

- **方向:** AWS VPC → オンプレミス（または外部）へのDNSクエリ
- **用途:** VPC内のEC2が「file-server.company.local」のような社内サーバーを名前解決したい場合に使用

**まとめ:** オンプレミスとAWSを接続して相互にDNS解決をしたい場合に、Route 53 Resolverのエンドポイント機能が必要になる。
